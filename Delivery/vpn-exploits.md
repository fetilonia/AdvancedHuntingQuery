# VPN exploit activity associated with MANGANESE

This query was originally published in the threat analytics report, *VPN exploits in MANGANESE attacks*.

MANGANESE is an activity group tracked by Microsoft. They are known to exploit Virtual Private Network (VPN) software to access their targets.

The following query locates possible attempts to drop malware and tools on devices in your network. These files are often used for lateral movement, privilege escalation, and credential access.

## Query

```Kusto
// Surface files or processes that match the 
// KB naming scheme and path used by MANGANESE
union DeviceFileEvents, DeviceProcessEvents
| where Timestamp > ago(7d)
// Look for file names that start with KB and endwith .exe
| where FileName startswith "kb"
| where FileName endswith ".exe"
// Check which path the files are created in
| extend FolderCount = countof(FolderPath, "\\")
| extend CreatedProcessFolderCount = countof(FolderPath, "\\")
| where FolderPath has "windows\\temp" and FolderCount == 3
// Confirm that the name matches the KB naming scheme
| where FileName matches regex "[0-9]{6,}" or
// Check created processes that match the described behavior
(FileName startswith "kb" and 
FileName endswith ".exe" and 
FolderPath has "windows\\temp" and CreatedProcessFolderCount == 3
and FileName matches regex "[0-9]{6,}")
```

## Category

This query can be used to detect the following attack techniques and tactics ([see MITRE ATT&CK framework](https://attack.mitre.org/)) or security configuration states.

| Technique, tactic, or state | Covered? (v=yes) | Notes |
|-|-|-|
| Initial access |  |  |
| Execution |  |  |
| Persistence |  |  |
| Privilege escalation | v |  |
| Defense evasion |  |  |
| Credential Access | v |  |
| Discovery |  |  |
| Lateral movement | v |  |
| Collection |  |  |
| Command and control |  |  |
| Exfiltration |  |  |
| Impact |  |  |
| Vulnerability |  |  |
| Misconfiguration |  |  |
| Malware, component |  |  |

## Contributor info

**Contributor:** Microsoft Threat Protection team